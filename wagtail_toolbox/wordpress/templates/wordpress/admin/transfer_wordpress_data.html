{% extends "wagtailadmin/base.html" %}
{% load static wagtailcore_tags admin_tags %}
{% block titletag %}Import Wordpress Data{% endblock %}

{% block content %}
{% include "wagtailadmin/shared/header.html" with title=title icon="download-alt" description=description %}

<div class="nice-padding">
    {% if models %}
    <table class="listing">
        {% comment %} <thead> {% endcomment %}
            <tr>
                <td colspan="3" style="background-color: #f3f3f3"><i>Targets</i></td>
                <td colspan="3" style="background-color: #f3f3f3"><i>Sources</i></td>
            </tr>
        {% comment %} </thead> {% endcomment %}
        {% comment %} <thead> {% endcomment %}
            <tr>
                <th scope="col"><b>Wagtail Model</b></th>
                <th scope="col"><b>Total Records</b></th>
                <td scope="col">&nbsp;</td>
                <th scope="col"><b>Wordpress Model</b></th>
                <th scope="col"><b>Total Records</b></th>
                <td scope="col"><b>Actions</b></td>
            </tr>
        {% comment %} </thead> {% endcomment %}
        {% comment %} <tbody> {% endcomment %}
            {% for model in models %}
            <tr>
                <td>{{ model.wagtail.name }}</td>
                <td>{{ model.wagtail.count }}</td>
                <td>
                    <svg class="icon icon-arrow-left w-w-4 w-h-4 w-ml-3" aria-hidden="true"><use href="#icon-arrow-left"></use></svg>
                </td>
                <td>{{ model.wordpress.name }}</td>
                <td>{{ model.wordpress.count }}</td>
                <td>
                    <a href="" class="button button-secondary button-small" data-select-records data-model="{{ model.wordpress.model }}">Select Records</a>
                </td>
            </tr>
            <tr class="hidden" data-selector-container>
                <td colspan="6">
                    <form method="POST" action="{{ transfer_command_url }}" class="transfer-form">
                    {% csrf_token %}
                    <input type="hidden" name="source-model" value="{{ model.wordpress.model }}">
                    <input type="hidden" name="target-model" value="{{ model.wagtail.model }}">
                    <div class="action-buttons">
                        <button class="button button-secondary button-small" data-select-all>Select All</button>
                        <button class="button button-secondary button-small" data-select-none>Unselect All</button>
                        <button type="submit" class="button button-primary button-longrunning button-small" data-transfer>
                            Transfer Selected
                        </button>
                        <b class="right">{{ model.wordpress.name }}
                            <svg class="icon icon-arrow-right w-w-4 w-h-4 w-ml-3" aria-hidden="true"><use href="#icon-arrow-right"></use></svg>
                            {{ model.wagtail.name }}
                        </b>
                    </div>
                    <ul class="record-list">
                    {% for record in model.wordpress.records %}
                        <li class="record-list__record">
                            <span>
                            <input 
                                type="checkbox" 
                                name="primary-keys" 
                                value="{{ record.id }}"
                                id="{{ model.wordpress.model }}-{{ record.id }}"
                            ><label for="{{ model.wordpress.model }}-{{ record.id }}">{{ record.title }}</label>
                            </span>
                        </li>
                    {% endfor %}
                    </ul>
                    </form>
                </td>
            </tr>
            {% endfor %}
        {% comment %} </tbody> {% endcomment %}
    </table>
    {% else %}
    <div class="help-block help-critical">
        <svg class="icon icon-warning icon" aria-hidden="true"><use href="#icon-warning"></use></svg>
        No endpoints found. Add them
        {% comment %} TODO: how to get the url here rather than absolute {% endcomment %}
        <a href="/admin/settings/wordpress/wordpresssettings">Wordpress settings</a> 
        could be performed and needs to be warned about.
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
    <script src="{% static 'wordpress/js/transfer.js' %}"></script>
{% endblock extra_js %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'wordpress/css/transfer.css' %}">
{% endblock extra_css %}
