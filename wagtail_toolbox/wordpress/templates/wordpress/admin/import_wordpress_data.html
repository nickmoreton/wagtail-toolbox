{% extends "wagtailadmin/base.html" %}
{% load static wagtailcore_tags admin_tags %}
{% block titletag %}Import Wordpress Data{% endblock %}

{% block content %}
{% include "wagtailadmin/shared/header.html" with title=title icon="download-alt" %}

<div class="nice-padding">
    {% if endpoints %}
    <table class="listing">
        <thead>
            <tr>
                <th scope="col">Name</th>
                <th scope="col">URL</th>
                <th scope="col">Model</th>
                <th scope="col">Import</th>

            </tr>
        </thead>
        <tbody>
            {% for endpoint in endpoints %}
            <tr>
                <td>{{ endpoint.name }}</td>
                <td>{{ endpoint.url }}</td>
                <td>{{ endpoint.model }}</td>
                <td>
                    <form method="POST" action="{{ run_command_url }}" class="stream-form">
                        {% csrf_token %}
                        <input type="hidden" name="host" value="{{ host }}">
                        <input type="hidden" name="model" value="{{ endpoint.model }}">
                        <input type="hidden" name="url" value="{{ endpoint.url }}">
                        <button type="submit" value="Import" class="button button-primary button-longrunning button-small">
                            Import
                        </button>
                        <a href="{% get_model_admin_url endpoint.model|lower %}" class="button button-secondary button-small" data-stream>View Imported {{ endpoint.name }}</a>
                    </form>
                </td>
            </tr>
            <tr class="row-container">
                <td colspan="4">
                    <div class="output-container">
                        <div class="output-content">
                            <textarea readonly data-message></textarea>
                        </div>
                        <div class="buttons">
                            <button class="button button-secondary button-small" type="button" data-close>Close</button>
                            <button class="button button-secondary button-small" type="button" data-clear>Clear</button>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="help-block help-critical">
        <svg class="icon icon-warning icon" aria-hidden="true"><use href="#icon-warning"></use></svg>
        No endpoints found. Add them
        {% comment %} TODO: how to get the url here rather than absolute {% endcomment %}
        <a href="/admin/settings/wordpress/wordpresssettings">Wordpress settings</a> 
        could be performed and needs to be warned about.
    </div>
    {% endif %}
</div>
<template id="stream-output-template">
<div id="stream-output-container" class="stream-output-container live">
    <div class="button-bar">
        <button id="clear" class="button button-small bicolor button--icon">
            <span class="icon-wrapper">
                <svg class="icon icon-no-view icon" aria-hidden="true">
                    <use href="#icon-no-view"></use>
                </svg>
            </span>Clear
        </button>
        <button id="close" class="button button-small bicolor button--icon">
            <span class="icon-wrapper">
                <svg class="icon icon-bin icon" aria-hidden="true">
                    <use href="#icon-bin"></use>
                </svg>
            </span>Close
        </button>
    </div>
    <textarea id="stream-output-content" class="stream-output-content live" readonly></textarea>
</div>
</template>
{% endblock %}

{% block extra_js %}
    <script src="{% static 'wordpress/js/stream.js' %}" type="text/javascript"></script>
{% endblock extra_js %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'wordpress/css/stream-output.css' %}">
{% endblock extra_css %}
